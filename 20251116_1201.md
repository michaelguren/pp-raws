# Session: 2025-11-16 - FDA All NDCs Gold Deployment

## Goal
Deploy minimal infrastructure to get **fda-all-ndcs GOLD data queryable in Athena** for QA validation and Delta Lake testing.

---

## Current State
- ✅ All AWS infrastructure deleted (clean slate)
- ✅ Bootstrap orchestration removed (obsolete)
- ✅ Simplified to single deployment command
- ⏸️ **READY TO DEPLOY**

---

## Deployment

### Single Command
```bash
npm run etl:deploy:fda
```

**Deploys 6 stacks:**
1. `pp-dw-etl-core` - S3, IAM, Glue databases
2. `pp-dw-etl-fda-nsde` - Bronze FDA NSDE
3. `pp-dw-etl-fda-cder` - Bronze FDA CDER
4. `pp-dw-etl-silver-fda-all-ndcs` - Silver (joined)
5. `pp-dw-etl-gold-fda-all-ndcs` - Gold (Delta Lake + Glue Crawler)
6. `pp-dw-daily-fda-orchestration` - Step Functions

**Expected time:** ~10-15 minutes

---

## Next Steps

1. **Deploy**: Run `npm run etl:deploy:fda`
2. **Populate Data**: Execute `pp-dw-daily-fda-orchestration` in Step Functions Console (~30-60 min)
3. **QA**: Manually run Athena queries to validate gold table
4. **Test Delta**: Test adds/deletes/updates (approach TBD)

---

## Key Architecture Notes

- **Gold tables**: Registered via Glue Crawlers with Delta Lake support (schema change policies: UPDATE_IN_DATABASE / DEPRECATE_IN_DATABASE)
- **Bronze/Silver**: Use crawlers after first job run (Step Functions orchestration)
- **Orchestration**: Step Functions handles "run job → check tables → run crawler" sequence
- **Shared Lambdas**: `infra/etl/orchestrations/shared/lambdas/`
- **Historical note**: AwsCustomResource pattern (Lambda-backed) has been deprecated in favor of Glue Crawlers

---

## Files Modified Today
- Deleted: `infra/etl/orchestrations/bootstrap/` (entire directory)
- Modified: `infra/etl/index.js` (removed bootstrap references)
- Modified: `package.json` (single deployment script)

---

## Todo
- [ ] Deploy: `npm run etl:deploy:fda`
- [ ] Run Step Functions: `pp-dw-daily-fda-orchestration`
- [ ] PAUSE - Manual Athena QA
- [ ] Delta Lake testing

---

*Last updated: 2025-11-16 12:20 PM*
